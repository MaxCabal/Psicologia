<div class="modal fade modal-xl" id="modalAgregarIntervencion" tabindex="-1" role="dialog"
	aria-labelledby="modalAgregarIntervencionLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="myModalLabel">Ingresar Intervencion</h4>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="alert alert-danger text-center d-none" id="ErrorIntervencionAgregada" >Error al agregar intervencion</div>
				<label id="nombreApellidos" class="nombresApellidos"></label>
				<form id="formAgregarIntervencion" class="form" role="form" autocomplete="off" th:object="${intervencion}" th:action="@{/crearIntervencion}" method="post">
					<input id="rutIntervencion" name="rut" type="hidden" th:field="${intervencion.rut}">
					<div class="form-group row">
						<label class="col-lg-3 col-form-label form-control-label">Observaciones</label>
						<div class="col-lg-9">
							<textarea class="form-control rounded-0" rows="3" maxlength="500" th:field="${intervencion.observaciones}"></textarea>
							<div class="alert-danger"
								th:if="${#fields.hasErrors('observaciones')}"
								th:errors="*{observaciones}"></div>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-3 col-form-label form-control-label">Objetivo</label>
						<div class="col-lg-9">
							<textarea class="form-control rounded-0" rows="3" maxlength="500" th:field="${intervencion.objetivo}"></textarea>
							<div class="alert-danger"
								th:if="${#fields.hasErrors('objetivo')}"
								th:errors="*{objetivo}"></div>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-3 col-form-label form-control-label">Fecha	de Control :</label>
						<div class="col-lg-9">
							<input class="form-control" type="text" id="fechacontrol" th:field="${intervencion.fecControl}">
							<div class="alert-danger" th:if="${#fields.hasErrors('fecControl')}" th:errors="*{fecControl}" th:text="${err}"></div>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-3 col-form-label form-control-label">Fase</label>
						<div class="col-lg-9">
							<select class="form-control" id="fase" th:field="${intervencion.fase}">
				 				<option th:each="fase :${fases}" th:value="${fase.idFase}" th:text="${fase.fase}" th:selected="(${fase.idFase == faseSelected})">
				 				</option>
							</select>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-3 col-form-label form-control-label">Tipo Intervencion</label>
						<div class="col-lg-9">
							<select class="form-control" id="tipoIntervencion" th:field="${intervencion.tipoIntervencion}">
				 				<option th:each="tipoIntervencion :${tiposIntervenciones}" th:value="${tipoIntervencion.idTipoIntervencion}" th:text="${tipoIntervencion.tipoIntervencion}" th:selected="(${tipoIntervencion.idTipoIntervencion == tipoIntervencionSelected})">
				 				</option>
							</select>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-lg-3 col-form-label form-control-label">Valor</label>
						<div class="col-lg-9">
							<input id="valor" class="form-control" type="number" th:field="${intervencion.valor}">
							<div class="alert-danger" th:if="${#fields.hasErrors('valor')}"	th:errors="*{valor}"></div>
						</div>
					</div>
					<div class="form-group row">
						<div class="col-lg-12 text-center">
							<button id="btnGuardarIntervencion" type="submit" class="btn btn-primary">Ingresar intervencion</button>
						</div>
					</div>
					<div class="alert alert-danger text-center"
						th:if="${formErrorMessage}" th:text="${formErrorMessage}">Error	Message</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script>

var editMode = false;

	$(document).on('show.bs.modal','#modalAgregarIntervencion', function (e) {
		if(editMode == false) {
			var href = $(e.relatedTarget);
		    var rut = href.data('whatever');
			var nombreYapellido = href.find('input[name="nombreYapellido"]').val();
			$('input[name="rut"]').val(rut);
			$('#nombreApellidos').text(nombreYapellido);
			editMode = true;
		}

	})

	$("#formAgregarIntervencion").submit(function(e) {
		e.preventDefault(); // avoid to execute the actual submit of the form.
	    var form = $(this);
	    var url = form.attr('action');
	    $.ajax({
	           type: "POST",
	           url: url,
	           data: form.serialize(), // serializes the form's elements.
	           success: function(data)
	           {
	        	    $("#ErrorIntervencionAgregada").addClass( "d-none" );
		        	$("#intervencionAgregada").removeClass( "d-none" );
		            $("#intervencionAgregada").html("Intervencion agregada correctamente");

		            $('#modalAgregarIntervencion').modal('toggle');
		            setTimeout(function(){	$("#intervencionAgregada").hide('slow'); }, 3000);
	           },
	           error : function(e) {
	        	   $("#ErrorIntervencionAgregada").removeClass( "d-none" );
	        	   $("#intervencionAgregada").addClass( "d-none" );
	        	   $("#ErrorIntervencionAgregada").html(e.responseText);
	        	   $("#ErrorIntervencionAgregada").show();
	        	   setTimeout(function(){	
	        		   $("#ErrorIntervencionAgregada").hide('slow'); 
	        	   }, 3000);
	           }
	    });
	});
</script>